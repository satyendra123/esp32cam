# in this i am sending the esp32cam image from the esp32cam module using tcp ip module. and write the python script which will receive the image and finds the qr data 
import time
import network
import camera
from microdot import Microdot, Response

# Replace with your WiFi credentials
ssid = "YOUR_SSID"
password = "YOUR_PASSWORD"

# Connect to WiFi
def connect_wifi():
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)
    wlan.connect(ssid, password)

    while not wlan.isconnected():
        time.sleep(1)
    print('Connected to WiFi', wlan.ifconfig())

connect_wifi()

# Initialize Camera
camera.init(
    framesize=camera.FRAME_VGA,  # Change as needed
    quality=10,
    fb_location=camera.PSRAM,
)

# Set up Microdot server
app = Microdot()

@app.route('/cam-hi.jpg')
def cam_hi(request):
    frame = camera.capture()
    if frame:
        return Response(frame, content_type='image/jpeg')
    else:
        return Response('Failed to capture image', status_code=500)

# Start the server
app.run(host='0.0.0.0', port=80)


EX-1 b) python script code
import cv2
import numpy as np
import pyzbar.pyzbar as pyzbar
import urllib.request
 
#cap = cv2.VideoCapture(0)
font = cv2.FONT_HERSHEY_PLAIN
 
url='http://192.168.1.61/'
cv2.namedWindow("live transmission", cv2.WINDOW_AUTOSIZE)
 
prev=""
pres=""
while True:
    img_resp=urllib.request.urlopen(url+'cam-hi.jpg')
    imgnp=np.array(bytearray(img_resp.read()),dtype=np.uint8)
    frame=cv2.imdecode(imgnp,-1)
    #_, frame = cap.read()
 
    decodedObjects = pyzbar.decode(frame)
    for obj in decodedObjects:
        pres=obj.data
        if prev == pres:
            pass
        else:
            print("Type:",obj.type)
            print("Data: ",obj.data)
            prev=pres
        cv2.putText(frame, str(obj.data), (50, 50), font, 2,
                    (255, 0, 0), 3)
 
    cv2.imshow("live transmission", frame)
 
    key = cv2.waitKey(1)
    if key == 27:
        break
 
cv2.destroyAllWindows()
